[
  {
    "projectId": "50267c09-6a28-4782-8f61-60b3ef67d65c",
    "testId": "9e8e8dc9-2991-4fbf-83fb-105c8ad25c1e",
    "userId": "c4e8c458-2061-70b7-f0eb-3ba257c28dde",
    "title": "TC001-test_jwt_token_refresh",
    "description": "Verify that the /api/auth/token/refresh/ endpoint successfully refreshes the JWT access token when provided with a valid refresh token.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nADMIN_AUTH = (\"admin@test.com\", \"test1234\")\nTIMEOUT = 30\n\n\ndef test_jwt_token_refresh():\n    session = requests.Session()\n\n    # Step 1: Login as admin to obtain refresh token\n    login_url = f\"{BASE_URL}/api/portal/auth/login/\"\n    login_payload = {\n        \"email\": ADMIN_AUTH[0],\n        \"password\": ADMIN_AUTH[1]\n    }\n    try:\n        login_resp = session.post(login_url, json=login_payload, timeout=TIMEOUT)\n        login_resp.raise_for_status()\n        tokens = login_resp.json().get(\"tokens\", {})\n        assert \"access\" in tokens and \"refresh\" in tokens, \"Login response missing tokens\"\n        refresh_token = tokens[\"refresh\"]\n\n        # Step 2: Use refresh token to get new access token\n        refresh_url = f\"{BASE_URL}/api/auth/token/refresh/\"\n        refresh_payload = {\"refresh\": refresh_token}\n        refresh_resp = session.post(refresh_url, json=refresh_payload, timeout=TIMEOUT)\n        refresh_resp.raise_for_status()\n        refreshed_tokens = refresh_resp.json()\n        assert \"access\" in refreshed_tokens, \"Refresh response missing new access token\"\n\n        new_access_token = refreshed_tokens[\"access\"]\n        assert isinstance(new_access_token, str) and len(new_access_token) > 0, \"Invalid new access token\"\n\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {str(e)}\"\n\n\ntest_jwt_token_refresh()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-12T09:56:55.656Z",
    "modified": "2026-01-12T09:57:46.069Z"
  },
  {
    "projectId": "50267c09-6a28-4782-8f61-60b3ef67d65c",
    "testId": "d22b4c46-4fe3-40e7-9519-ab2df5db29fb",
    "userId": "c4e8c458-2061-70b7-f0eb-3ba257c28dde",
    "title": "TC002-test_portal_user_login",
    "description": "Verify that the /api/portal/auth/login/ endpoint allows portal users to login and returns a nested tokens object containing access and refresh tokens.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\n\ndef test_portal_user_login():\n    url = f\"{BASE_URL}/api/portal/auth/login/\"\n    payload = {\n        \"email\": \"admin@test.com\",\n        \"password\": \"test1234\"\n    }\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=TIMEOUT)\n        response.raise_for_status()\n    except requests.RequestException as e:\n        assert False, f\"Request to login failed: {e}\"\n\n    json_data = response.json()\n\n    assert \"tokens\" in json_data, \"Response JSON does not contain 'tokens' key\"\n    assert isinstance(json_data[\"tokens\"], dict), \"'tokens' should be a dictionary\"\n    assert \"access\" in json_data[\"tokens\"], \"'tokens' does not contain 'access' token\"\n    assert \"refresh\" in json_data[\"tokens\"], \"'tokens' does not contain 'refresh' token\"\n    assert isinstance(json_data[\"tokens\"][\"access\"], str) and len(json_data[\"tokens\"][\"access\"]) > 0, \"'access' token should be a non-empty string\"\n    assert isinstance(json_data[\"tokens\"][\"refresh\"], str) and len(json_data[\"tokens\"][\"refresh\"]) > 0, \"'refresh' token should be a non-empty string\"\n\ntest_portal_user_login()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-12T09:56:55.662Z",
    "modified": "2026-01-12T09:57:47.181Z"
  },
  {
    "projectId": "50267c09-6a28-4782-8f61-60b3ef67d65c",
    "testId": "16c95687-1976-484a-8127-02b7513e0d6e",
    "userId": "c4e8c458-2061-70b7-f0eb-3ba257c28dde",
    "title": "TC003-test_portal_user_registration",
    "description": "Verify that the /api/portal/auth/register/ endpoint allows portal user registration only when password and password_confirm fields match, and returns appropriate success or error responses.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nREGISTER_URL = f\"{BASE_URL}/api/portal/auth/register/\"\nLOGIN_URL = f\"{BASE_URL}/api/portal/auth/login/\"\n\nADMIN_AUTH = (\"admin@test.com\", \"test1234\")\nTIMEOUT = 30\nHEADERS = {\"Content-Type\": \"application/json\"}\n\n\ndef test_portal_user_registration():\n    # Test data for registration with matching passwords (success case)\n    user_data_success = {\n        \"email\": \"testuser_success@example.com\",\n        \"full_name\": \"Test User Success\",\n        \"password\": \"StrongPass123!\",\n        \"password_confirm\": \"StrongPass123!\",\n        \"role\": \"student\"\n    }\n\n    # Test data for registration with mismatched passwords (error case)\n    user_data_error = {\n        \"email\": \"testuser_error@example.com\",\n        \"full_name\": \"Test User Error\",\n        \"password\": \"StrongPass123!\",\n        \"password_confirm\": \"WrongPass123!\",\n        \"role\": \"student\"\n    }\n\n    # Helper to delete created user if registration succeeded\n    def delete_user(access_token, user_id):\n        url = f\"{BASE_URL}/api/users/{user_id}/\"\n        headers = {\"Authorization\": f\"Bearer {access_token}\"}\n        try:\n            requests.delete(url, headers=headers, timeout=TIMEOUT)\n        except Exception:\n            pass\n\n    # 1. Register user with matching passwords - expect success and user object returned\n    response_success = requests.post(REGISTER_URL, json=user_data_success, timeout=TIMEOUT)\n    assert response_success.status_code == 201 or response_success.status_code == 200, f\"Expected 201 or 200, got {response_success.status_code}\"\n    resp_json = response_success.json()\n    assert \"user\" in resp_json, \"Response JSON should contain 'user' object\"\n    user = resp_json[\"user\"]\n    assert user.get(\"full_name\") == user_data_success[\"full_name\"], \"Registered user's full_name does not match\"\n\n    # Cleanup: Login as admin to get access token for deleting the created user\n    admin_login_resp = requests.post(LOGIN_URL, json={\"email\": ADMIN_AUTH[0], \"password\": ADMIN_AUTH[1]}, timeout=TIMEOUT)\n    assert admin_login_resp.status_code == 200, \"Admin login failed\"\n    admin_access_token = admin_login_resp.json()['tokens']['access']\n\n    user_id = user.get(\"id\")\n    assert user_id is not None, \"Registered user ID is missing\"\n    try:\n        # 2. Register user with mismatched password_confirm - expect validation error\n        response_error = requests.post(REGISTER_URL, json=user_data_error, timeout=TIMEOUT)\n        # Expect 400 Bad Request or similar client error\n        assert response_error.status_code == 400 or response_error.status_code == 422, f\"Expected 400 or 422 for mismatched passwords, got {response_error.status_code}\"\n        error_json = response_error.json()\n        # Check error message refers to password mismatch\n        error_msgs = str(error_json).lower()\n        assert \"password\" in error_msgs and (\"confirm\" in error_msgs or \"match\" in error_msgs), \"Error message should mention password confirmation mismatch\"\n    finally:\n        # Delete the successfully created user to keep test environment clean\n        delete_user(admin_access_token, user_id)\n\n\ntest_portal_user_registration()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-12T09:56:55.668Z",
    "modified": "2026-01-12T09:57:59.235Z"
  },
  {
    "projectId": "50267c09-6a28-4782-8f61-60b3ef67d65c",
    "testId": "770aef1b-5347-4be6-8c8a-b3a81fe76ba0",
    "userId": "c4e8c458-2061-70b7-f0eb-3ba257c28dde",
    "title": "TC004-test_workstream_user_login",
    "description": "Verify that the /api/workstream/{workstream_id}/auth/login/ endpoint allows workstream users to login and returns a nested tokens object containing access and refresh tokens.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nADMIN_AUTH = (\"admin@test.com\", \"test1234\")\nHEADERS = {\"Content-Type\": \"application/json\"}\nTIMEOUT = 30\n\n\ndef test_workstream_user_login():\n    # Helper function to handle admin auth and get token\n    def admin_login():\n        response = requests.post(\n            f\"{BASE_URL}/api/portal/auth/login/\",\n            json={\"email\": ADMIN_AUTH[0], \"password\": ADMIN_AUTH[1]},\n            headers=HEADERS,\n            timeout=TIMEOUT,\n        )\n        response.raise_for_status()\n        tokens = response.json().get(\"tokens\")\n        assert tokens and \"access\" in tokens and \"refresh\" in tokens\n        return tokens[\"access\"]\n\n    # Helper to get admin user id\n    def get_admin_user_id(admin_token):\n        headers = dict(HEADERS)\n        headers[\"Authorization\"] = f\"Bearer {admin_token}\"\n        response = requests.get(f\"{BASE_URL}/api/users/\", headers=headers, timeout=TIMEOUT)\n        response.raise_for_status()\n        users = response.json()\n        admin_user = next((u for u in users if u.get(\"email\") == ADMIN_AUTH[0]), None)\n        assert admin_user and \"id\" in admin_user, \"Admin user not found\"\n        return admin_user[\"id\"]\n\n    # Create a workstream user to login with\n    def create_workstream_user(workstream_id, admin_token):\n        user_data = {\n            \"email\": \"workstream_user_login_test@example.com\",\n            \"full_name\": \"Workstream User Login Test\",\n            \"password\": \"TestPass123!\",\n            \"password_confirm\": \"TestPass123!\",\n            \"role\": \"teacher\",\n            \"work_stream\": workstream_id\n        }\n        headers = dict(HEADERS)\n        headers[\"Authorization\"] = f\"Bearer {admin_token}\"\n        response = requests.post(\n            f\"{BASE_URL}/api/workstream/{workstream_id}/auth/register/\",\n            json=user_data,\n            headers=headers,\n            timeout=TIMEOUT,\n        )\n        response.raise_for_status()\n        user = response.json().get(\"user\")\n        assert user and \"full_name\" in user\n        return user_data[\"email\"], user_data[\"password\"]\n\n    admin_token = None\n    admin_user_id = None\n    workstream_id = None\n    user_email = None\n    user_password = None\n\n    try:\n        # Admin login to get token for further creations\n        admin_token = admin_login()\n        admin_user_id = get_admin_user_id(admin_token)\n\n        # Create workstream with admin user as manager\n        workstream_data = {\n            \"name\": \"Test Workstream TC004\",\n            \"manager_id\": admin_user_id,\n            \"max_user\": 10,\n        }\n        headers = dict(HEADERS)\n        headers[\"Authorization\"] = f\"Bearer {admin_token}\"\n        response = requests.post(\n            f\"{BASE_URL}/api/workstream/\", json=workstream_data, headers=headers, timeout=TIMEOUT\n        )\n        response.raise_for_status()\n        ws = response.json()\n        assert ws and \"id\" in ws\n        workstream_id = ws[\"id\"]\n\n        # Create a workstream user to login\n        user_email, user_password = create_workstream_user(workstream_id, admin_token)\n\n        # Now perform login via /api/workstream/{workstream_id}/auth/login/\n        login_data = {\"email\": user_email, \"password\": user_password}\n        response = requests.post(\n            f\"{BASE_URL}/api/workstream/{workstream_id}/auth/login/\",\n            json=login_data,\n            headers=HEADERS,\n            timeout=TIMEOUT,\n        )\n        response.raise_for_status()\n        tokens = response.json().get(\"tokens\")\n        assert tokens is not None, \"Response should contain 'tokens' object\"\n        assert \"access\" in tokens and \"refresh\" in tokens, \"'tokens' must have 'access' and 'refresh'\"\n        access_token = tokens[\"access\"]\n        assert isinstance(access_token, str) and len(access_token) > 0, \"Access token should be a non-empty string\"\n\n    finally:\n        # Cleanup: delete the created workstream user and workstream if possible\n        headers = {}\n        if admin_token:\n            headers[\"Authorization\"] = f\"Bearer {admin_token}\"\n\n        # Delete workstream user\n        if user_email and admin_token:\n            try:\n                resp_users = requests.get(\n                    f\"{BASE_URL}/api/users/\", headers=headers, timeout=TIMEOUT\n                )\n                resp_users.raise_for_status()\n                users = resp_users.json()\n                user_to_delete = next((u for u in users if u.get(\"email\") == user_email), None)\n                if user_to_delete and \"id\" in user_to_delete:\n                    requests.delete(\n                        f\"{BASE_URL}/api/users/{user_to_delete['id']}/\",\n                        headers=headers,\n                        timeout=TIMEOUT,\n                    )\n            except Exception:\n                pass\n\n        # Delete workstream\n        if workstream_id and admin_token:\n            try:\n                requests.post(\n                    f\"{BASE_URL}/api/workstreams/{workstream_id}/deactivate/\",\n                    headers=headers,\n                    timeout=TIMEOUT,\n                )\n                requests.delete(\n                    f\"{BASE_URL}/api/workstreams/{workstream_id}/\",\n                    headers=headers,\n                    timeout=TIMEOUT,\n                )\n            except Exception:\n                pass\n\n\ntest_workstream_user_login()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 143, in <module>\n  File \"<string>\", line 79, in test_workstream_user_login\n  File \"/var/task/requests/models.py\", line 1024, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nrequests.exceptions.HTTPError: 400 Client Error: Bad Request for url: http://localhost:8000/api/workstream/\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-12T09:56:55.673Z",
    "modified": "2026-01-12T09:59:40.955Z"
  },
  {
    "projectId": "50267c09-6a28-4782-8f61-60b3ef67d65c",
    "testId": "3420d111-08cd-41d9-96bb-381e14170b1f",
    "userId": "c4e8c458-2061-70b7-f0eb-3ba257c28dde",
    "title": "TC005-test_workstream_user_registration",
    "description": "Verify that the /api/workstream/{workstream_id}/auth/register/ endpoint allows workstream user registration only when password and password_confirm fields match, and returns appropriate success or error responses.",
    "code": "import requests\n\n\nBASE_URL = \"http://localhost:8000\"\nADMIN_EMAIL = \"admin@test.com\"\nADMIN_PASSWORD = \"test1234\"\nTIMEOUT = 30\n\n\ndef test_workstream_user_registration():\n    session = requests.Session()\n    try:\n        # Admin login to get access token\n        login_resp = session.post(\n            f\"{BASE_URL}/api/portal/auth/login/\",\n            json={\"email\": ADMIN_EMAIL, \"password\": ADMIN_PASSWORD},\n            timeout=TIMEOUT,\n        )\n        assert login_resp.status_code == 200, f\"Admin login failed: {login_resp.text}\"\n        admin_access_token = login_resp.json()[\"tokens\"][\"access\"]\n\n        headers_admin = {\"Authorization\": f\"Bearer {admin_access_token}\"}\n\n        # Create a user with role manager_workstream (required to create workstream)\n        manager_email = \"workstream_manager@test.com\"\n        manager_password = \"ManWrk123!\"\n        create_manager_resp = session.post(\n            f\"{BASE_URL}/api/users/create/\",\n            headers=headers_admin,\n            json={\n                \"email\": manager_email,\n                \"full_name\": \"Workstream Manager\",\n                \"password\": manager_password,\n                \"role\": \"manager_workstream\",\n            },\n            timeout=TIMEOUT,\n        )\n        assert create_manager_resp.status_code == 201, f\"Manager user creation failed: {create_manager_resp.text}\"\n        manager_user = create_manager_resp.json()\n        manager_id = manager_user[\"id\"]\n\n        # Create a workstream with required fields\n        workstream_name = \"Test Workstream Registration\"\n        max_user = 10\n        create_workstream_resp = session.post(\n            f\"{BASE_URL}/api/workstream/\",\n            headers=headers_admin,\n            json={\n                \"name\": workstream_name,\n                \"manager_id\": manager_id,\n                \"max_user\": max_user,\n            },\n            timeout=TIMEOUT,\n        )\n        assert create_workstream_resp.status_code == 201, f\"Workstream creation failed: {create_workstream_resp.text}\"\n        workstream = create_workstream_resp.json()\n        workstream_id = workstream[\"id\"]\n\n        # Test successful registration where password and password_confirm match\n        registration_url = f\"{BASE_URL}/api/workstream/{workstream_id}/auth/register/\"\n        user_email = \"newuser@test.com\"\n        user_full_name = \"New Workstream User\"\n        user_password = \"StrongPass123\"\n        user_role = \"student\"\n\n        success_reg_resp = session.post(\n            registration_url,\n            json={\n                \"email\": user_email,\n                \"full_name\": user_full_name,\n                \"password\": user_password,\n                \"password_confirm\": user_password,\n                \"role\": user_role,\n            },\n            timeout=TIMEOUT,\n        )\n        assert success_reg_resp.status_code == 201, f\"Successful registration failed: {success_reg_resp.text}\"\n        success_reg_json = success_reg_resp.json()\n        assert \"user\" in success_reg_json, \"'user' not in success response\"\n        registered_user = success_reg_json[\"user\"]\n        assert registered_user.get(\"full_name\") == user_full_name, \"Registered user full_name mismatch\"\n\n        # Test failed registration when password and password_confirm do not match\n        fail_reg_resp = session.post(\n            registration_url,\n            json={\n                \"email\": \"failuser@test.com\",\n                \"full_name\": \"Fail User\",\n                \"password\": \"Password123\",\n                \"password_confirm\": \"Password321\",\n                \"role\": \"student\",\n            },\n            timeout=TIMEOUT,\n        )\n        assert fail_reg_resp.status_code == 400, f\"Registration with mismatched password did not fail properly: {fail_reg_resp.text}\"\n        fail_json = fail_reg_resp.json()\n        # Expecting some error about password confirmation mismatch in response\n        password_confirm_errors = fail_json.get(\"password_confirm\") or fail_json.get(\"non_field_errors\") or {}\n        assert password_confirm_errors, \"No error info about password_confirm mismatch\"\n\n    finally:\n        # Cleanup: Delete created users and workstream to avoid residual data\n\n        # Delete registered user (successful registration)\n        try:\n            # Need to find ID of registered user from success_reg_json if available\n            reg_user_id = success_reg_json[\"user\"][\"id\"]\n            del_user_resp = session.delete(\n                f\"{BASE_URL}/api/users/{reg_user_id}/\",\n                headers=headers_admin,\n                timeout=TIMEOUT,\n            )\n            assert del_user_resp.status_code in (200, 204), f\"Failed to delete registered user: {del_user_resp.text}\"\n        except Exception:\n            pass\n\n        # Delete workstream manager user\n        try:\n            del_manager_resp = session.delete(\n                f\"{BASE_URL}/api/users/{manager_id}/\",\n                headers=headers_admin,\n                timeout=TIMEOUT,\n            )\n            assert del_manager_resp.status_code in (200, 204), f\"Failed to delete manager user: {del_manager_resp.text}\"\n        except Exception:\n            pass\n\n        # Delete workstream\n        try:\n            del_workstream_resp = session.delete(\n                f\"{BASE_URL}/api/workstreams/{workstream_id}/\",\n                headers=headers_admin,\n                timeout=TIMEOUT,\n            )\n            # If DELETE endpoint not supported, ignore failure here\n            if del_workstream_resp.status_code not in (200, 204):\n                # Alternative: try deactivate if delete unsupported\n                patch_resp = session.post(\n                    f\"{BASE_URL}/api/workstreams/{workstream_id}/deactivate/\",\n                    headers=headers_admin,\n                    timeout=TIMEOUT,\n                )\n                assert patch_resp.status_code in (200, 204), f\"Failed to deactivate workstream: {patch_resp.text}\"\n        except Exception:\n            pass\n\n\ntest_workstream_user_registration()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-12T09:56:55.679Z",
    "modified": "2026-01-12T09:57:52.765Z"
  },
  {
    "projectId": "50267c09-6a28-4782-8f61-60b3ef67d65c",
    "testId": "f0106df1-9dde-47c5-94a0-e6a01fa12272",
    "userId": "c4e8c458-2061-70b7-f0eb-3ba257c28dde",
    "title": "TC006-test_user_creation_with_role_validation",
    "description": "Verify that the /api/users/create/ endpoint creates a new user with required fields including email, full_name, password, and role, and validates role choices correctly.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nADMIN_EMAIL = \"admin@test.com\"\nADMIN_PASSWORD = \"test1234\"\nHEADERS = {\"Content-Type\": \"application/json\"}\nTIMEOUT = 30\n\n\ndef get_admin_access_token():\n    url = f\"{BASE_URL}/api/portal/auth/login/\"\n    payload = {\"email\": ADMIN_EMAIL, \"password\": ADMIN_PASSWORD}\n    resp = requests.post(url, json=payload, headers=HEADERS, timeout=TIMEOUT)\n    resp.raise_for_status()\n    return resp.json()[\"tokens\"][\"access\"]\n\n\ndef create_user(token, email, full_name, password, role):\n    url = f\"{BASE_URL}/api/users/create/\"\n    headers = {**HEADERS, \"Authorization\": f\"Bearer {token}\"}\n    payload = {\n        \"email\": email,\n        \"full_name\": full_name,\n        \"password\": password,\n        \"password_confirm\": password,\n        \"role\": role,\n    }\n    resp = requests.post(url, json=payload, headers=headers, timeout=TIMEOUT)\n    return resp\n\n\ndef delete_user(token, user_id):\n    url = f\"{BASE_URL}/api/users/{user_id}/\"\n    headers = {**HEADERS, \"Authorization\": f\"Bearer {token}\"}\n    resp = requests.delete(url, headers=headers, timeout=TIMEOUT)\n    resp.raise_for_status()\n\n\ndef test_user_creation_with_role_validation():\n    access_token = get_admin_access_token()\n\n    valid_role = \"teacher\"\n    invalid_role = \"invalid_role_xyz\"\n    email = \"autotestuser+valid@example.com\"\n    full_name = \"Auto Test User Valid\"\n    password = \"TestPass1234!\"\n\n    # Create user with valid role\n    resp_valid = create_user(access_token, email, full_name, password, valid_role)\n    try:\n        assert resp_valid.status_code in (201, 200), \\\n            f\"Expected 201 or 200, got {resp_valid.status_code}\"\n        user = resp_valid.json()\n        assert user.get(\"email\") == email, \"Email mismatch in created user\"\n        assert user.get(\"full_name\") == full_name, \"Full name mismatch in created user\"\n        assert user.get(\"role\") == valid_role, \"Role mismatch in created user\"\n        user_id = user.get(\"id\")\n        assert user_id is not None, \"Created user missing 'id'\"\n    except Exception:\n        # Cleanup if user created\n        if resp_valid.status_code in [201, 200] and 'user_id' in locals():\n            delete_user(access_token, user_id)\n        raise\n\n    # Create user with invalid role - expect error response\n    email_invalid = \"autotestuser+invalid@example.com\"\n    full_name_invalid = \"Auto Test User Invalid\"\n    resp_invalid = create_user(access_token, email_invalid, full_name_invalid, password, invalid_role)\n    # Typically, validation error returns 400 Bad Request\n    assert resp_invalid.status_code == 400, f\"Expected 400 for invalid role, got {resp_invalid.status_code}\"\n    json_response = resp_invalid.json()\n    # The error should mention role field or role choices\n    role_errors = json_response.get(\"role\") or json_response.get(\"errors\") or json_response\n    assert any(\n        (isinstance(role_errors, dict) and any(\"role\" in k.lower() or \"choice\" in k.lower() for k in role_errors.keys()))\n        or (isinstance(role_errors, list) and any(\"role\" in e.lower() or \"choice\" in e.lower() for e in role_errors))\n        or (\"role\" in str(role_errors).lower())\n    ), f\"Expected role validation error message, got {json_response}\"\n\n    # Cleanup created user with valid role\n    delete_user(access_token, user_id)\n\n\ntest_user_creation_with_role_validation()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 84, in <module>\n  File \"<string>\", line 51, in test_user_creation_with_role_validation\nAssertionError: Expected 201 or 200, got 400\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-12T09:56:55.684Z",
    "modified": "2026-01-12T09:59:04.742Z"
  },
  {
    "projectId": "50267c09-6a28-4782-8f61-60b3ef67d65c",
    "testId": "03daef4e-c285-4fb8-b1b6-76ae8a181ffb",
    "userId": "c4e8c458-2061-70b7-f0eb-3ba257c28dde",
    "title": "TC007-test_user_activation",
    "description": "Verify that the /api/users/{user_id}/activate/ endpoint activates a user account and returns the appropriate success response.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nADMIN_EMAIL = \"admin@test.com\"\nADMIN_PASSWORD = \"test1234\"\nTIMEOUT = 30\n\ndef test_user_activation():\n    session = requests.Session()\n\n    # Step 1: Admin login to get access token\n    login_payload = {\n        \"email\": ADMIN_EMAIL,\n        \"password\": ADMIN_PASSWORD\n    }\n    login_resp = session.post(f\"{BASE_URL}/api/portal/auth/login/\", json=login_payload, timeout=TIMEOUT)\n    assert login_resp.status_code == 200, f\"Admin login failed: {login_resp.text}\"\n    access_token = login_resp.json()['tokens']['access']\n    headers = {\"Authorization\": f\"Bearer {access_token}\"}\n\n    # Step 2: Create a new user (inactive by default)\n    user_payload = {\n        \"email\": \"activatetestuser@example.com\",\n        \"full_name\": \"Activate Test User\",\n        \"password\": \"TestUserPass123!\",\n        \"role\": \"student\"\n    }\n    create_resp = session.post(f\"{BASE_URL}/api/users/create/\", json=user_payload, headers=headers, timeout=TIMEOUT)\n    assert create_resp.status_code == 201, f\"User creation failed: {create_resp.text}\"\n    user = create_resp.json()\n    user_id = user['id']\n\n    try:\n        # Step 3: Activate the user via /api/users/{user_id}/activate/\n        activate_resp = session.post(f\"{BASE_URL}/api/users/{user_id}/activate/\", headers=headers, timeout=TIMEOUT)\n        assert activate_resp.status_code == 200, f\"User activation failed: {activate_resp.text}\"\n\n        # Step 4: Verify response content for success indication\n        activate_json = activate_resp.json()\n        assert 'detail' in activate_json or 'message' in activate_json, \"Activation success message missing\"\n        # Optionally check that user is now active via GET user\n        get_resp = session.get(f\"{BASE_URL}/api/users/{user_id}/\", headers=headers, timeout=TIMEOUT)\n        assert get_resp.status_code == 200, f\"User retrieval failed after activation: {get_resp.text}\"\n        user_details = get_resp.json()\n        assert user_details.get('is_active') is True or user_details.get('active') is True, \"User not active after activation\"\n    finally:\n        # Cleanup: Delete the created user\n        delete_resp = session.delete(f\"{BASE_URL}/api/users/{user_id}/\", headers=headers, timeout=TIMEOUT)\n        assert delete_resp.status_code in (200, 204), f\"User deletion failed: {delete_resp.text}\"\n\ntest_user_activation()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 51, in <module>\n  File \"<string>\", line 29, in test_user_activation\nAssertionError: User creation failed: {\"email\":\"A user with this email already exists.\"}\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-12T09:56:55.689Z",
    "modified": "2026-01-12T09:58:34.631Z"
  },
  {
    "projectId": "50267c09-6a28-4782-8f61-60b3ef67d65c",
    "testId": "4d3ddefd-3faa-4009-8ce2-fb32137af74c",
    "userId": "c4e8c458-2061-70b7-f0eb-3ba257c28dde",
    "title": "TC008-test_workstream_creation",
    "description": "Verify that the /api/workstream/ endpoint creates a new workstream with required fields name, manager_id, and max_user, and returns the created workstream details.",
    "code": "import requests\nimport uuid\n\nBASE_URL = \"http://localhost:8000\"\nADMIN_EMAIL = \"admin@test.com\"\nADMIN_PASSWORD = \"test1234\"\nTIMEOUT = 30\n\n\ndef test_workstream_creation():\n    session = requests.Session()\n    try:\n        # Step 1: Admin login to get access token\n        login_resp = session.post(\n            f\"{BASE_URL}/api/portal/auth/login/\",\n            json={\"email\": ADMIN_EMAIL, \"password\": ADMIN_PASSWORD},\n            timeout=TIMEOUT,\n        )\n        assert login_resp.status_code == 200, f\"Admin login failed: {login_resp.text}\"\n        access_token = login_resp.json().get(\"tokens\", {}).get(\"access\")\n        assert access_token, \"No access token received on admin login\"\n\n        headers = {\"Authorization\": f\"Bearer {access_token}\"}\n\n        # Step 2: Create a user with role 'manager_workstream' to use as manager for the workstream\n        unique_email = f\"manager_workstream_test_{uuid.uuid4().hex[:8]}@example.com\"\n        user_payload = {\n            \"email\": unique_email,\n            \"full_name\": \"Manager Workstream Test\",\n            \"password\": \"TestPass123!\",\n            \"role\": \"manager_workstream\",\n        }\n\n        user_create_resp = session.post(\n            f\"{BASE_URL}/api/users/create/\",\n            json=user_payload,\n            headers=headers,\n            timeout=TIMEOUT,\n        )\n        assert user_create_resp.status_code == 201, f\"Manager user creation failed: {user_create_resp.text}\"\n        user_data = user_create_resp.json()\n        manager_id = user_data.get(\"id\")\n        assert manager_id, \"No user ID found for manager_workstream user\"\n\n        # Step 3: Create workstream with required fields name, manager_id, max_user\n        workstream_payload = {\n            \"name\": \"Test Workstream TC008\",\n            \"manager_id\": manager_id,\n            \"max_user\": 10,\n        }\n        workstream_create_resp = session.post(\n            f\"{BASE_URL}/api/workstream/\",\n            json=workstream_payload,\n            headers=headers,\n            timeout=TIMEOUT,\n        )\n\n        assert workstream_create_resp.status_code == 201, f\"Workstream creation failed: {workstream_create_resp.text}\"\n        workstream_data = workstream_create_resp.json()\n        assert workstream_data.get(\"name\") == workstream_payload[\"name\"], \"Workstream name mismatch\"\n        assert workstream_data.get(\"manager_id\") == manager_id, \"Workstream manager_id mismatch\"\n        assert workstream_data.get(\"max_user\") == 10, \"Workstream max_user mismatch\"\n        assert \"id\" in workstream_data, \"Workstream ID missing in response\"\n\n    finally:\n        # Cleanup: delete created workstream and user\n        # Delete workstream if created\n        if 'workstream_data' in locals() and \"id\" in workstream_data:\n            ws_id = workstream_data[\"id\"]\n            # No explicit delete endpoint provided for workstream in PRD;\n            # Assuming delete by direct DELETE /api/workstreams/{workstream_id}/\n            delete_ws_resp = session.delete(\n                f\"{BASE_URL}/api/workstreams/{ws_id}/\",\n                headers=headers,\n                timeout=TIMEOUT,\n            )\n\n        # Delete user if created\n        if 'manager_id' in locals():\n            delete_user_resp = session.delete(\n                f\"{BASE_URL}/api/users/{manager_id}/\",\n                headers=headers,\n                timeout=TIMEOUT,\n            )\n\n\ntest_workstream_creation()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-12T09:56:55.695Z",
    "modified": "2026-01-12T09:59:04.741Z"
  },
  {
    "projectId": "50267c09-6a28-4782-8f61-60b3ef67d65c",
    "testId": "c2c936a7-cb21-4f7f-963e-08e7e566e684",
    "userId": "c4e8c458-2061-70b7-f0eb-3ba257c28dde",
    "title": "TC009-test_school_creation_with_manager_validation",
    "description": "Verify that the /api/manager/schools/create/ endpoint creates a new school with required school_name and work_stream_id, and optionally assigns a manager with role MANAGER_SCHOOL.",
    "code": "import requests\nimport uuid\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\nADMIN_EMAIL = \"admin@test.com\"\nADMIN_PASSWORD = \"test1234\"\nHEADERS_JSON = {\"Content-Type\": \"application/json\"}\n\n\ndef login_portal(email, password):\n    url = f\"{BASE_URL}/api/portal/auth/login/\"\n    payload = {\"email\": email, \"password\": password}\n    resp = requests.post(url, json=payload, headers=HEADERS_JSON, timeout=TIMEOUT)\n    resp.raise_for_status()\n    tokens = resp.json().get(\"tokens\", {})\n    access = tokens.get(\"access\")\n    if not access:\n        raise Exception(\"Access token not found after login\")\n    return access\n\n\ndef create_user(access_token, email, full_name, password, role):\n    url = f\"{BASE_URL}/api/users/create/\"\n    headers = {\"Authorization\": f\"Bearer {access_token}\", **HEADERS_JSON}\n    payload = {\n        \"email\": email,\n        \"full_name\": full_name,\n        \"password\": password,\n        \"password_confirm\": password,\n        \"role\": role,\n    }\n    resp = requests.post(url, json=payload, headers=headers, timeout=TIMEOUT)\n    resp.raise_for_status()\n    user = resp.json()\n    if not user or \"id\" not in user:\n        raise Exception(\"User creation failed - no user id returned\")\n    return user\n\n\ndef delete_user(access_token, user_id):\n    url = f\"{BASE_URL}/api/users/{user_id}/\"\n    headers = {\"Authorization\": f\"Bearer {access_token}\"}\n    resp = requests.delete(url, headers=headers, timeout=TIMEOUT)\n    # allow 200 or 204 as success for delete\n    if resp.status_code not in (200, 204):\n        raise Exception(f\"Failed to delete user id {user_id}, status: {resp.status_code}\")\n\n\ndef create_workstream(access_token, name, manager_id, max_user=10):\n    url = f\"{BASE_URL}/api/workstream/\"\n    headers = {\"Authorization\": f\"Bearer {access_token}\", **HEADERS_JSON}\n    payload = {\n        \"name\": name,\n        \"manager_id\": manager_id,\n        \"max_user\": max_user,\n    }\n    resp = requests.post(url, json=payload, headers=headers, timeout=TIMEOUT)\n    resp.raise_for_status()\n    workstream = resp.json()\n    if \"id\" not in workstream:\n        raise Exception(\"Workstream creation failed - no id returned\")\n    return workstream\n\n\ndef delete_workstream(access_token, workstream_id):\n    url = f\"{BASE_URL}/api/workstreams/{workstream_id}/deactivate/\"\n    headers = {\"Authorization\": f\"Bearer {access_token}\"}\n    resp = requests.post(url, headers=headers, timeout=TIMEOUT)\n    if resp.status_code not in (200, 204):\n        # fallback to actual delete if deactivate endpoint does not remove\n        del_url = f\"{BASE_URL}/api/workstreams/{workstream_id}/\"\n        del_resp = requests.delete(del_url, headers=headers, timeout=TIMEOUT)\n        if del_resp.status_code not in (200, 204):\n            raise Exception(f\"Failed to delete workstream id {workstream_id}, status: {del_resp.status_code}\")\n\n\ndef create_school(access_token, school_name, work_stream_id, manager_id=None):\n    url = f\"{BASE_URL}/api/manager/schools/create/\"\n    headers = {\"Authorization\": f\"Bearer {access_token}\", **HEADERS_JSON}\n    payload = {\n        \"school_name\": school_name,\n        \"work_stream_id\": work_stream_id,\n    }\n    if manager_id:\n        payload[\"manager_id\"] = manager_id\n    resp = requests.post(url, json=payload, headers=headers, timeout=TIMEOUT)\n    resp.raise_for_status()\n    school = resp.json()\n    if \"id\" not in school:\n        raise Exception(\"School creation failed - no id returned\")\n    return school\n\n\ndef delete_school(access_token, school_id):\n    url = f\"{BASE_URL}/api/manager/schools/{school_id}/\"\n    headers = {\"Authorization\": f\"Bearer {access_token}\"}\n    resp = requests.delete(url, headers=headers, timeout=TIMEOUT)\n    if resp.status_code not in (200, 204):\n        raise Exception(f\"Failed to delete school id {school_id}, status: {resp.status_code}\")\n\n\ndef test_school_creation_with_manager_validation():\n    access_token = login_portal(ADMIN_EMAIL, ADMIN_PASSWORD)\n\n    # Create a manager_workstream user (required for workstream creation)\n    mw_email = f\"mw_{uuid.uuid4().hex[:8]}@test.com\"\n    mw_full_name = \"Workstream Manager Test\"\n    mw_password = \"WmPass123!\"\n    manager_workstream_user = create_user(access_token, mw_email, mw_full_name, mw_password, \"manager_workstream\")\n\n    # Create a workstream with the above manager_workstream user\n    workstream_name = f\"Test WS {uuid.uuid4().hex[:6]}\"\n    workstream = create_workstream(access_token, workstream_name, manager_workstream_user[\"id\"]) \n\n    # Create a manager_school user (to assign optionally to the school)\n    ms_email = f\"ms_{uuid.uuid4().hex[:8]}@test.com\"\n    ms_full_name = \"School Manager Test\"\n    ms_password = \"MsPass123!\"\n    manager_school_user = create_user(access_token, ms_email, ms_full_name, ms_password, \"manager_school\")\n\n    # We'll create 2 schools: one without a manager, one with a manager_school assigned\n\n    created_school_ids = []\n    try:\n        # Create school without manager_id\n        school_name_wo_manager = f\"SchoolNoMgr {uuid.uuid4().hex[:6]}\"\n        school1 = create_school(access_token, school_name_wo_manager, workstream[\"id\"], manager_id=None)\n        created_school_ids.append(school1[\"id\"])\n\n        # Validate response keys and values\n        assert school1[\"school_name\"] == school_name_wo_manager\n        assert school1[\"work_stream_id\"] == workstream[\"id\"]\n        assert \"manager_id\" not in school1 or school1.get(\"manager_id\") in (None, \"\")\n\n        # Create school WITH manager_id as manager_school role user\n        school_name_with_manager = f\"SchoolWithMgr {uuid.uuid4().hex[:6]}\"\n        school2 = create_school(access_token, school_name_with_manager, workstream[\"id\"], manager_id=manager_school_user[\"id\"])\n        created_school_ids.append(school2[\"id\"])\n\n        assert school2[\"school_name\"] == school_name_with_manager\n        assert school2[\"work_stream_id\"] == workstream[\"id\"]\n        assert school2[\"manager_id\"] == manager_school_user[\"id\"]\n\n        # Negative test: try to create school with invalid manager role (e.g. use manager_workstream user as manager_school)\n        url = f\"{BASE_URL}/api/manager/schools/create/\"\n        headers = {\"Authorization\": f\"Bearer {access_token}\", **HEADERS_JSON}\n        invalid_payload = {\n            \"school_name\": f\"InvalidSchool {uuid.uuid4().hex[:6]}\",\n            \"work_stream_id\": workstream[\"id\"],\n            \"manager_id\": manager_workstream_user[\"id\"],  # manager_workstream user, invalid as school manager\n        }\n        resp = requests.post(url, json=invalid_payload, headers=headers, timeout=TIMEOUT)\n        # Expect bad request (400) or forbidden (403)\n        assert resp.status_code in (400, 403)\n\n    finally:\n        # Clean up created schools\n        for school_id in created_school_ids:\n            try:\n                delete_school(access_token, school_id)\n            except Exception:\n                pass\n        # Clean up created workstream and users\n        try:\n            delete_workstream(access_token, workstream[\"id\"])\n        except Exception:\n            pass\n        try:\n            delete_user(access_token, manager_workstream_user[\"id\"])\n        except Exception:\n            pass\n        try:\n            delete_user(access_token, manager_school_user[\"id\"])\n        except Exception:\n            pass\n\n\ntest_school_creation_with_manager_validation()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 179, in <module>\n  File \"<string>\", line 128, in test_school_creation_with_manager_validation\n  File \"<string>\", line 88, in create_school\n  File \"/var/task/requests/models.py\", line 1024, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nrequests.exceptions.HTTPError: 400 Client Error: Bad Request for url: http://localhost:8000/api/manager/schools/create/\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-12T09:56:55.701Z",
    "modified": "2026-01-12T09:59:40.957Z"
  },
  {
    "projectId": "50267c09-6a28-4782-8f61-60b3ef67d65c",
    "testId": "847905ab-a8e2-489c-9a8f-7c4a9aa3cf4c",
    "userId": "c4e8c458-2061-70b7-f0eb-3ba257c28dde",
    "title": "TC010-test_academic_year_creation",
    "description": "Verify that the /api/manager/schools/{school_id}/academic-years/create/ endpoint creates a new academic year for the specified school and returns the created academic year details.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\n\n\ndef test_academic_year_creation():\n    headers = {\"Content-Type\": \"application/json\"}\n\n    # Step 1: Admin login to get access token\n    login_payload = {\n        \"email\": \"admin@test.com\",\n        \"password\": \"test1234\"\n    }\n    try:\n        login_resp = requests.post(\n            f\"{BASE_URL}/api/portal/auth/login/\",\n            json=login_payload,\n            timeout=TIMEOUT,\n            headers=headers,\n        )\n        assert login_resp.status_code == 200\n        access_token = login_resp.json()[\"tokens\"][\"access\"]\n    except Exception as e:\n        assert False, f\"Admin login failed: {e}\"\n\n    auth_headers = {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": f\"Bearer {access_token}\"\n    }\n\n    # Step 2: Create a manager_workstream user\n    manager_ws_payload = {\n        \"email\": \"managerws_test_academic_year@test.com\",\n        \"full_name\": \"Manager Workstream AcademicYear\",\n        \"password\": \"Test1234!\",\n        \"password_confirm\": \"Test1234!\",\n        \"role\": \"manager_workstream\"\n    }\n    try:\n        user_create_resp = requests.post(\n            f\"{BASE_URL}/api/users/create/\",\n            json=manager_ws_payload,\n            headers=auth_headers,\n            timeout=TIMEOUT,\n        )\n        assert user_create_resp.status_code == 201\n        manager_ws_id = user_create_resp.json()[\"id\"]\n    except Exception as e:\n        assert False, f\"Manager Workstream user creation failed: {e}\"\n\n    # Step 3: Create a workstream with the above manager id\n    workstream_payload = {\n        \"name\": \"Workstream AcademicYear Test\",\n        \"manager_id\": manager_ws_id,\n        \"max_user\": 10\n    }\n    try:\n        workstream_resp = requests.post(\n            f\"{BASE_URL}/api/workstream/\",\n            json=workstream_payload,\n            headers=auth_headers,\n            timeout=TIMEOUT,\n        )\n        assert workstream_resp.status_code == 201\n        workstream_id = workstream_resp.json()[\"id\"]\n    except Exception as e:\n        # Clean up manager user\n        requests.delete(f\"{BASE_URL}/api/users/{manager_ws_id}/\", headers=auth_headers, timeout=TIMEOUT)\n        assert False, f\"Workstream creation failed: {e}\"\n\n    # Step 4: Create a manager_school user\n    manager_school_payload = {\n        \"email\": \"managersc_academic_year@test.com\",\n        \"full_name\": \"Manager School AcademicYear\",\n        \"password\": \"Test1234!\",\n        \"password_confirm\": \"Test1234!\",\n        \"role\": \"manager_school\"\n    }\n    try:\n        user_school_resp = requests.post(\n            f\"{BASE_URL}/api/users/create/\",\n            json=manager_school_payload,\n            headers=auth_headers,\n            timeout=TIMEOUT,\n        )\n        assert user_school_resp.status_code == 201\n        manager_school_id = user_school_resp.json()[\"id\"]\n    except Exception as e:\n        # Cleanup workstream and manager_ws user\n        requests.delete(f\"{BASE_URL}/api/workstreams/{workstream_id}/\", headers=auth_headers, timeout=TIMEOUT)\n        requests.delete(f\"{BASE_URL}/api/users/{manager_ws_id}/\", headers=auth_headers, timeout=TIMEOUT)\n        assert False, f\"Manager School user creation failed: {e}\"\n\n    # Step 5: Create a school with the workstream and manager_school id\n    school_payload = {\n        \"school_name\": \"Academic Year Test School\",\n        \"work_stream_id\": workstream_id,\n        \"manager_id\": manager_school_id\n    }\n    try:\n        school_resp = requests.post(\n            f\"{BASE_URL}/api/manager/schools/create/\",\n            json=school_payload,\n            headers=auth_headers,\n            timeout=TIMEOUT,\n        )\n        assert school_resp.status_code == 201\n        school_id = school_resp.json()[\"id\"]\n    except Exception as e:\n        # Cleanup manager_school, workstream, manager_ws users\n        requests.delete(f\"{BASE_URL}/api/users/{manager_school_id}/\", headers=auth_headers, timeout=TIMEOUT)\n        requests.delete(f\"{BASE_URL}/api/workstreams/{workstream_id}/\", headers=auth_headers, timeout=TIMEOUT)\n        requests.delete(f\"{BASE_URL}/api/users/{manager_ws_id}/\", headers=auth_headers, timeout=TIMEOUT)\n        assert False, f\"School creation failed: {e}\"\n\n    # Step 6: Create academic year for the school\n    academic_year_payload = {\n        \"name\": \"2026-2027 Academic Year\",\n        \"start_date\": \"2026-09-01\",\n        \"end_date\": \"2027-06-30\",\n        \"is_active\": True\n    }\n    try:\n        academic_year_resp = requests.post(\n            f\"{BASE_URL}/api/manager/schools/{school_id}/academic-years/create/\",\n            json=academic_year_payload,\n            headers=auth_headers,\n            timeout=TIMEOUT,\n        )\n        assert academic_year_resp.status_code == 201\n        academic_year_data = academic_year_resp.json()\n        assert academic_year_data[\"name\"] == academic_year_payload[\"name\"]\n        assert academic_year_data[\"is_active\"] is True\n    except Exception as e:\n        # Cleanup school, manager_school, workstream, manager_ws users\n        try:\n            requests.delete(f\"{BASE_URL}/api/manager/schools/{school_id}/\", headers=auth_headers, timeout=TIMEOUT)\n        except Exception:\n            pass\n        requests.delete(f\"{BASE_URL}/api/users/{manager_school_id}/\", headers=auth_headers, timeout=TIMEOUT)\n        requests.delete(f\"{BASE_URL}/api/workstreams/{workstream_id}/\", headers=auth_headers, timeout=TIMEOUT)\n        requests.delete(f\"{BASE_URL}/api/users/{manager_ws_id}/\", headers=auth_headers, timeout=TIMEOUT)\n        assert False, f\"Academic year creation failed: {e}\"\n\n    # Cleanup all created resources\n    try:\n        # Delete academic year\n        academic_year_id = academic_year_data.get(\"id\")\n        if academic_year_id:\n            requests.delete(\n                f\"{BASE_URL}/api/manager/schools/{school_id}/academic-years/{academic_year_id}/\",\n                headers=auth_headers,\n                timeout=TIMEOUT,\n            )\n    except Exception:\n        pass\n\n    try:\n        requests.delete(f\"{BASE_URL}/api/manager/schools/{school_id}/\", headers=auth_headers, timeout=TIMEOUT)\n    except Exception:\n        pass\n\n    try:\n        requests.delete(f\"{BASE_URL}/api/users/{manager_school_id}/\", headers=auth_headers, timeout=TIMEOUT)\n    except Exception:\n        pass\n\n    try:\n        requests.delete(f\"{BASE_URL}/api/workstreams/{workstream_id}/\", headers=auth_headers, timeout=TIMEOUT)\n    except Exception:\n        pass\n\n    try:\n        requests.delete(f\"{BASE_URL}/api/users/{manager_ws_id}/\", headers=auth_headers, timeout=TIMEOUT)\n    except Exception:\n        pass\n\n\ntest_academic_year_creation()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"<string>\", line 47, in test_academic_year_creation\nAssertionError\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 180, in <module>\n  File \"<string>\", line 50, in test_academic_year_creation\nAssertionError: Manager Workstream user creation failed: \n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-12T09:56:55.706Z",
    "modified": "2026-01-12T09:59:23.673Z"
  }
]
